<%= render partial: "admin/manage/header" %>
<%= render partial: "admin/manage/menu" %>
<%= render partial: "#{engine_prefix}admin/parts/visits_menu" %>

<%= tag.div "Filtered by controller: #{params[:controller_name]}", class: "fw-bold m-1" if params[:controller_name] %>
<%= tag.div "Filtered by action: #{params[:action_name]}", class: "fw-bold m-1" if params[:action_name] %>

<% if @user %>
<% visitor = @user.my_impressions.first %>
<div class="border border-dark border-2 p-1 my-1 bg-white">
<%= render partial: "#{engine_prefix}admin/parts/visitor", locals: {visitor:visitor,index:1} %>
</div>
<% end %>

<div class="bg-light" style="overflow-x: scroll;">
<div class="d-flex p-1 align-items-center">
<% @users.each do |user| %>
<div class="p-1 mb-1 me-1 border text-center" style="min-width:140px;">
<%= link_to user.display_name_public,feedbacker.url_for({user_id:user.id}), class: class_names("fs-8 d-flex", {active: user.id == params[:user_id]}) %> <%= tag.span "#{time_ago_in_words(user.last_view)} ago", class: "fs-8 d-flex text-muted" unless user.last_view.nil? %>
</div>
<% end %>

</div>
</div>

<div><%= Impression.count %> total impressions</div>
<div class="d-flex align-items-center bg-white border-top border-bottom mb-2 px-1">
<%= "#{@visitors.total_count} rows" if false %>
<%= feedbacker_paginate @visitors,page: params[:page], wrap_css: "" %>
</div>
<% @visitors.each do |visitor| %>
<div class="mb-2 bg-white border p-1 rounded">
	<%= render visitor %>

	<div class="px-2 fs-7 d-flex flex-wrap p-1">
	<% Site.views_per_user(ip:visitor.ip_address).each do |user_row| %>
	<div class="d-flex align-items-center border rounded mb-1 me-1">
		<span class="badge bg-info text-dark mx-1"><%= user_row.impressions_count %></span>
	<%= render partial: "users/parts/list_row", locals: {user:user_row,show_extra:false,size:"micro",wrap_css: "p-1 fs-7",is_admin:false} %>

	</div>


	<% end %>
	</div>

	<div class="px-2 fs-7 d-flex flex-wrap p-1">

		<% Site.last_actions(ip:visitor.ip_address).each do |row| %>
		<div class="d-flex align-items-center border me-1 mb-1">
			<%= tag.span row.row_count, class: "badge badge-sm bg-info mx-1" %>
			<div class="px-1">
				<%= row.controller_name %>: <%= row.action_name %>
			</div>
		</div>
		
		<% end %>
	</div>

</div>
<% end %>
<%= feedbacker_paginate @visitors,page: params[:page], wrap_css: "" %>